{% extends "base.html" %}

{% block scripts %}
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		google.load('visualization', '1.0', {'packages':['corechart']});
		google.setOnLoadCallback(drawChart);

		function drawChart() {
			var data = new google.visualization.DataTable();
			data.addColumn('string', 'Игрок');
			data.addColumn('number', 'Рейтинг');
			{% for stat in stats %}
			data.addRows(
				[{{ stat.gamer.name }}, {{ stat.rating }}],
				);
			{% endfor %}

			var options = {'title':'Вклад игрока в суммарный рейтинг',
				'width':400,
				'height':300};

			var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
			chart.draw(data, options);
		}
	</script>
{% endblock %}

{% block main %}
<div id="info">
	<table>
		<tr>
			<th colspan="2" class="text-center">Информация о игре</th>
		</tr>
		<tr>
			<td class="text-right">Дата:</td>
			<td>{{ game.date }}</td>
		</tr>
		<tr>
			<td class="text-right">Количество игроков:</td>
			<td>{{ game.gamersCount }}</td>
		</tr>
	</table>
</div>
<div id="chart_div"></div>
<div id="achives">
	Достижения:<br>
	<ul>
		{% for achievement in game.achievements %}
		<li>{{ achievement.achievementType.name }} ({{ achievement.achievementType.level }}, получена <a href="{{ achievement.gamer.keyStr }}">{{ achievement.gamer.name }}</a>)</li>
		{% endfor %}
	</ul>
</div>
<div id="stats">
	<table class="elements-center">
		<tr>
			<th colspan="9">Игровая статистика</th>
		</tr>
		<tr>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}gamer.name">Имя</a></th>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}color">Цвет</a></th>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}rating">Рейтинг</a></th>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}accuracy">Точность</a></th>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}damage">Урон</a></th>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}countOfDeaths">Количество смертей</a></th>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}countOfInjuries">Количество ранений</a></th>
			<th><a href="?key={{ game.keyStr }}&orderBy={{ suffix }}usedCartridge">Использовано патронов</a></th>
		</tr>
		{% for stat in stats %}
		<tr>	
			<td>{{ stat.gamer.name }} ({{ stat.gamer.nick }})</td>
			<td>{{ stat.color }}</td>
			<td>{{ stat.rating }}</td>
			<td>{{ stat.accuracy }}</td>
			<td>{{ stat.damage }}</td>
			<td>{{ stat.countOfDeaths }}</td>
			<td>{{ stat.countOfInjuries }}</td>
			<td>{{ stat.usedCartridge }}</td>
		</tr>
		{% endfor %}
	</table>
</div>
<div id="plots">
</div>
{% endblock %}